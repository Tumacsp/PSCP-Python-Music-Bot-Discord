import discord
from discord.ext import commands
from discord import Embed
import youtube_dl
from song import*


# token bot
TOKEN = ''

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å  bot 
bot = commands.Bot(command_prefix="/", intents=discord.Intents.all())


# ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ bot ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
@bot.event
async def on_ready(): # ‡∏ñ‡πâ‡∏≤ bot ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    print("The bot is now ready for use!")
    print("------------------------------")
    try:
        synced = await bot.tree.sync()
        print(f"Synced {len(synced)} command(s)") # ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á bot ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
    except Exception as e:
        print(e)


# ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ã‡∏¥‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå

@bot.event
async def on_member_join(member):
    await member.send(f'Welcome to the server, {member.mention}! Enjoy your stay here.')


@bot.tree.command(name="hello", description="Replies with Hello")
async def hellocommand(interaction: discord.Interaction):
    await interaction.response.send_message("Hello It's me BUT DISCORD")

# ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ö‡∏≠‡∏ó‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏∏‡∏¢
@bot.command()
async def join(ctx):  # Join ‡πÄ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
    if ctx.author.voice:
        channel = ctx.message.author.voice.channel
        await channel.connect()
        await ctx.send("Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ßÔøΩ")
    else:
        # ‡∏Å‡∏£‡∏ì‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á555
        await ctx.send("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‚ùå")

# ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ö‡∏≠‡∏ó‡∏≠‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏∏‡∏¢
@bot.command()
async def leave(ctx):  # Leave ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    if ctx.voice_client:
        await ctx.guild.voice_client.disconnect()
        await ctx.send("Bot ‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ßüëã")
    else:
        # ‡∏Å‡∏£‡∏ì‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        await ctx.send("Bot ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‚ùå")

# ////////////// ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á //////////////////////


ydl_opts = {'format': 'bestaudio/best',
            'postprocessors': [{'key': 'FFmpegExtractAudio',
                                'preferredcodec': 'mp3',
                                'preferredquality': '192', }], }

@bot.command(pass_context=True)
async def play(ctx, url):
    if (ctx.author.voice): # ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á ‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
        channel = ctx.message.author.voice.channel
        await channel.connect()
        await ctx.send("Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß üòé")
        await ctx.send("--- ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ---")
    else:
        await ctx.send("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‚ùó")

    voice = ctx.voice_client # ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    with youtube_dl.YoutubeDL(ydl_opts) as ydl:
        file = ydl.extract_info(url, download=False)  # ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ download
        
    url = file['formats'][0]['url'] #‡∏•‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏•‡∏á
    thumb = file['thumbnails'][0]['url'] # ‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏•‡∏á
    title = file['title'] #‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á

    voice.play(discord.FFmpegPCMAudio(url))
    voice.is_playing()

    voice.source = discord.PCMVolumeTransformer(voice.source, 1)

    await ctx.send(f'**Music: **{title}') # ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á
    await ctx.send(thumb) # ‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏•‡∏á



# ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á
@bot.command()
async def pause(ctx):  # ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ü‡∏±‡∏á‡∏ï‡πà‡∏≠‡∏ô‡∏∞
    voice = discord.utils.get(bot.voice_clients, guild=ctx.guild)
    if voice.is_playing():
        voice.pause()
        await ctx.send("Paused ‚è∏")
    else:
        await ctx.send("‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á!‚ùó")

# ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á
@bot.command()
async def resume(ctx):
    voice = discord.utils.get(bot.voice_clients, guild=ctx.guild)
    if voice.is_paused():
        voice.resume()
        await ctx.send("Resume ‚èØ")
    else:
        await ctx.send("‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‚ùó")

# ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏•‡∏¢ ‡πÅ‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏ü‡∏±‡∏á‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß
@bot.command()
async def stop(ctx):
    voice = discord.utils.get(bot.voice_clients, guild=ctx.guild)
    voice.stop()
    await ctx.send("Stop ‚õî")


#//////////////// ‡πÅ‡∏°‡∏ô‡∏π Help ///////////////////

@bot.tree.command(name="help", description="Bot commands")
async def hellocommand(ctx):
    embed = Embed(title="Help me!", color=0xff2450)
    embed.add_field(name="/help", value="Bot commands", inline=False)
    embed.add_field(name="/hello", value="Hello It's me", inline=False)
    embed.add_field(name="/bot", value="Yes, the bot is cool.", inline=False)
    embed.add_field(name="/play", value="play music", inline=False)
    embed.add_field(name="/stop", value="stop music", inline=False)
    embed.add_field(name="/pause", value="pause music", inline=False)
    embed.add_field(name="/leave", value="Bot leave", inline=False)
    embed.add_field(name="/join", value="Bot join", inline=False)
    await ctx.response.send_message(embed=embed)


bot.run(TOKEN)

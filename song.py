import discord
from discord.ext import commands
import youtube_dl
from discord import Embed



bot = commands.Bot(command_prefix="/", intents= discord.Intents.all())

# ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á

ydl_opts = {'format': 'bestaudio'}
ffmpeg_options = {'before_options': '-reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 5', 'options': '-vn'}
# ‡πÅ‡∏Å‡πâ‡∏ö‡∏≠‡∏ó‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏°‡πà‡∏à‡∏ö

@bot.command(pass_context=True)
async def play(ctx, url):
    # ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á ‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
    voice = ctx.voice_client # ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    with youtube_dl.YoutubeDL(ydl_opts) as ydl:
        file = ydl.extract_info(url, download=False) # ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ download
        url = file['formats'][0]['url'] #‡∏•‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏•‡∏á
    voice.play(discord.FFmpegPCMAudio(url, **ffmpeg_options))
    voice.is_playing() # ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á
        
    thumb = file['thumbnail'] # ‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏•‡∏á
    title = file['title'] #‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á
    view = file['view_count'] # ‡∏¢‡∏≠‡∏î‡∏ß‡∏¥‡∏ß
    date = file['upload_date'] # ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
    time = file['duration'] #‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏•‡∏á
    # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏•‡∏á
    minute= int(time/60)
    second = int(time%60)

    # Embed ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á
    embed = Embed(title="üé∂Now playingüé∂", color=0xFF0046)
    embed.add_field(name=f"Music: {title}", value="‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî", inline=False)
    embed.add_field(name="üïò| Duration", value=f"{minute} ‡∏ô‡∏≤‡∏ó‡∏µ | {second} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ", inline=True)
    embed.add_field(name="üëÄ| Views", value=f"‡∏Å‡∏≤‡∏£‡∏î‡∏π {view} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á | ‡πÄ‡∏°‡∏∑‡πà‡∏≠ {date}", inline=True)
    embed.set_thumbnail(url=thumb) # ‡∏£‡∏π‡∏õ‡πÄ‡∏•‡πá‡∏Å
    embed.set_footer(text='Bot Music Mode',icon_url='https://media.discordapp.net/attachments/1039567269992341554/1051132242577084516/1.1.png') # footer
    await ctx.channel.send(embed=embed)



# ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á
@bot.command()
async def pause(ctx):  # ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ü‡∏±‡∏á‡∏ï‡πà‡∏≠‡∏ô‡∏∞
    voice = discord.utils.get(bot.voice_clients, guild=ctx.guild)
    if voice.is_playing():
        voice.pause()
        await ctx.send("Paused ‚è∏")
    else:
        await ctx.send("‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á!‚ùó")

# ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏•‡∏á
@bot.command()
async def resume(ctx):
    voice = discord.utils.get(bot.voice_clients, guild=ctx.guild)
    if voice.is_paused():
        voice.resume()
        await ctx.send("Resume ‚èØ")
    else:
        await ctx.send("‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‚ùó")

# ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏•‡∏¢ ‡πÅ‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏ü‡∏±‡∏á‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß
@bot.command()
async def stop(ctx):
    voice = discord.utils.get(bot.voice_clients, guild=ctx.guild)
    voice.stop()
    await ctx.send("Stop ‚õî")